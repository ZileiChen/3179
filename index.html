<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Ore Processed by State in Australia</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  </head>
  <body>
    <h1>Ore Processed by State in Australia</h1>
    <div id="vis"></div>

    <script>
      // Sample data: Total ore processed and number of mines by state, need to make this actual data later somehow
      const stateData = [
        { State: "Western Australia", OreProcessed: 1500, Mines: 10 },
        { State: "New South Wales", OreProcessed: 800, Mines: 5 },
        { State: "Victoria", OreProcessed: 600, Mines: 4 },
        { State: "Queensland", OreProcessed: 1200, Mines: 7 },
        { State: "South Australia", OreProcessed: 500, Mines: 3 },
        { State: "Tasmania", OreProcessed: 300, Mines: 2 },
        { State: "Northern Territory", OreProcessed: 200, Mines: 1 },
      ];

      const australiaTopoJSON = "states.json";

      const spec = {
        $schema: "https://vega.github.io/schema/vega-lite/v5.json",
        width: 800,
        height: 600,
        projection: { type: "mercator", center: [133, -28], scale: 600 },
        layer: [
          {
            data: {
              url: australiaTopoJSON,
              format: { type: "topojson", feature: "states" },
            },
            mark: { type: "geoshape", stroke: "black", strokeWidth: 0.5 },
            encoding: {
              color: {
                field: "OreProcessed",
                type: "quantitative",
                scale: { scheme: "blues", domain: [200, 1500] },
                title: "Ore Processed (Mt)",
              },
              tooltip: [
                { field: "properties.STATE_NAME", type: "nominal", title: "State" },
                { field: "OreProcessed", type: "quantitative", title: "Total Ore Processed (Mt)" },
                { field: "Mines", type: "quantitative", title: "Number of Mines" },
              ],
            },
            transform: [
              {
                lookup: "properties.STATE_NAME",
                from: {
                  data: { values: stateData },
                  key: "State",
                  fields: ["OreProcessed", "Mines"],
                },
              },
            ],
          },
          {
            data: {
              url: australiaTopoJSON,
              format: { type: "topojson", feature: "states" },
            },
            mark: { type: "text", dy: -20, fontSize: 14, fontWeight: "bold" },
            encoding: {
              longitude: { field: "properties.LON", type: "quantitative" },
              latitude: { field: "properties.LAT", type: "quantitative" },
              text: { field: "Mines", type: "quantitative" },
              tooltip: [{ field: "Mines", type: "quantitative", title: "Mines" }],
            },
            transform: [
              {
                lookup: "properties.STATE_NAME",
                from: {
                  data: { values: stateData },
                  key: "State",
                  fields: ["Mines"],
                },
              },
            ],
          },
        ],
      };

      vegaEmbed("#vis", spec);
    </script>
  </body>
</html>
